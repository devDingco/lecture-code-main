<!-- https://www.randomnumberapi.com/api/v1.0/random?min=1&max=100&count=1  -->
<!-- https://jsonplaceholder.typicode.com/todos/${num} -->
<!-- https://jsonplaceholder.typicode.com/posts?userId=${userId} -->

<!DOCTYPE html>
<html lang="ko">
    <head>
        <title>콜백과 친구들</title>
        <script>
            // function addEventListener(aaa, bbb) {
            //   사전에 셋팅된 API주소로 요청이 끝나면?
            //   const res = 70; 셋팅된 API주소에서 받아온 결과
            //   bbb(res)
            // }

            const onClickCallback = () => {
                const aa = new XMLHttpRequest();
                aa.open("get", "https://www.randomnumberapi.com/api/v1.0/random?min=1&max=100&count=1");
                aa.send();
                aa.addEventListener("load", (res) => {
                    console.log(res); // API요청 결과
                    const num = res.target.response; // 70

                    const bb = new XMLHttpRequest();
                    bb.open("get", `https://jsonplaceholder.typicode.com/todos/${num}`);
                    bb.send();
                    bb.addEventListener("load", (res) => {
                        const userId = res.target.response.userId; // { ... 게시글 }

                        const cc = new XMLHttpRequest();
                        cc.open("get", `https://jsonplaceholder.typicode.com/posts?userId=${userId}`);
                        cc.send();
                        cc.addEventListener("load", (res) => {
                            console.log(res.target.response); // 해당 유저가 쓴 다른 게시글 목록들...
                        });
                    });
                });
            };

            const onClickPromise = () => {
                console.log("1번째로 실행됩니다!!!");
                fetch("https://www.randomnumberapi.com/api/v1.0/random?min=1&max=100&count=1")
                    .then((res) => {
                        console.log("2번째로 실행됩니다!!!");
                        console.log(res); // API요청 결과
                        const num = res.target.response; // 70

                        return fetch(`https://jsonplaceholder.typicode.com/todos/${num}`);
                    })
                    .then((res) => {
                        console.log("3번째로 실행됩니다!!!");
                        const userId = res.target.response.userId; // { ... 게시글 }

                        return fetch(`https://jsonplaceholder.typicode.com/posts?userId=${userId}`);
                    })
                    .then((res) => {
                        console.log("4번째로 실행됩니다!!!");
                        console.log(res.target.response); // 해당 유저가 쓴 다른 게시글 목록들...
                    })
                    .catch((error) => {
                        // 에러 통합 처리
                    });
                console.log("5번째로 실행됩니다!!!");
            };

            // fetch, axios 등 => 대표적인 Promise를 지원하는 기능
            // Promise를 기다리는 2가지 방법
            // 1. .then()을 활용
            // 2. await를 활용  =>  await는 아무거나 기다리는게 아니고, Promise를 기다림
            const onClickAsyncAwait = async () => {
                const num = await fetch("https://www.randomnumberapi.com/api/v1.0/random?min=1&max=100&count=1");
                const userId = await fetch(`https://jsonplaceholder.typicode.com/todos/${num}`);
                const result = await fetch(`https://jsonplaceholder.typicode.com/posts?userId=${userId}`);
            };
        </script>
    </head>
    <body>
        <button onclick="onClickCallback()">Callback 연습하기</button>
        <button onclick="onClickPromise()">Promise 연습하기</button>
        <button onclick="onClickAsyncAwait()">AsyncAwait 연습하기</button>
    </body>
</html>
